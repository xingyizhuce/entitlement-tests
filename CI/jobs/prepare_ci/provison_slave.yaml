- job-template:
    name: 'Entitlement_Provison_Install_Add_Slave'
    node: 'provision-slave'
    description: |
        Provision slave system.
    concurrent: true
    scm:
        - git:
            url: 'http://git.app.eng.bos.redhat.com/git/ci-ops-central.git'
            branches:
                - origin/master
            basedir: ci-ops-central
            git-config-name: "ftan"
            git-config-email: "ftan@redhat.com"
        - git:
            url: 'http://git.app.eng.bos.redhat.com/git/job-runner.git'
            branches:
                - origin/master
            basedir: job-runner
            git-config-name: "ftan"
            git-config-email: "ftan@redhat.com"
        - git:
            url: 'http://git.app.eng.bos.redhat.com/git/entitlement-tests.git'
            branches:
                - origin/master
            basedir: entitlement-tests
            git-config-name: "ftan"
            git-config-email: "ftan@redhat.com"
    parameters:
        - string:
            name: Slave_Name
            default:
            description:
        - string:
            name: Slave_Label
            default: entitlement
            description:
    builders:
        - shell: |
            #!/bin/bash
            export System_IP=
            export Password=

            # Provison slave system and add it as node in jenkins master
            ci-ops-central/bootstrap/provision_jslave.sh \
            --project_defaults=entitlement-tests/CI/config/project-entitlement-qe-jenkins \
            --ssh_keyfile=entitlement-tests/CI/keys/ent-qe-entitlement-qe-jenkins \
            --topology=entitlement-tests/CI/config/slave-system \
            --jenkins_master_url=$JENKINS_MASTER_URL \
            --jslavelabel=$Slave_Label \
            --jslave_execs=10 \
            --jslavename=$Slave_Name \
            --jslavecreate | tee output.log

            # Export IP variable
            export `cat output.log | grep 'JSLAVEIP='`
            env > env.txt

            # Install slave environment
            pushd entitlement-tests/
            python Tools/RemoteSSH_scripts/prepare_slave.py
            STATUS=$?
            popd

            if [ $STATUS -eq 0 ]; then
              exit 1
            fi

    publishers:
        - archive:
            artifacts: '*.txt'
            allow-empty: 'true'
    wrappers:
        - ansicolor
        - workspace-cleanup
        - timestamps

- job-template:
    name: 'Entitlement_Prepare_Slave_Environment'
    node: 'provision-slave'
    description: |
        Provision slave system.
    concurrent: true
    scm:
        - git:
            url: 'http://git.app.eng.bos.redhat.com/git/entitlement-tests.git'
            branches:
                - origin/master
            basedir: entitlement-tests
            git-config-name: "ftan"
            git-config-email: "ftan@redhat.com"
    parameters:
        - string:
            name: Slave_IP
            default:
            description:
    builders:
        - shell: |
            #!/bin/bash
            export System_IP=
            export Password=
            export JSLAVEIP=$Slave_IP

            pushd entitlement-tests/
            python Tools/RemoteSSH_scripts/prepare_slave.py

            if [ $STATUS -eq 0 ]; then
              exit 1
            fi

    publishers:
        - archive:
            artifacts: '*.txt'
            allow-empty: 'true'
    wrappers:
        - ansicolor
        - workspace-cleanup
        - timestamps

- project:
   name: Entitlement_provison_project
   jobs:
    - Entitlement_Provison_Install_Add_Slave
    - Entitlement_Prepare_Slave_Environment